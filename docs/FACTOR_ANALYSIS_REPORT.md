# 📈 特征有效性与因子分析报告 (Factor Analysis Report)

**适用范围**：`data/processed` 阶段的数据（特征工程后）。  
**生成脚本**：`python scripts/check_features.py`  
**目标受众**：量化策略师、算法工程师。

---

## 1. 概述 (Executive Summary)

本报告旨在评估构建的因子（Features）对训练目标（Label）的预测能力，并检查数据的完整性与合规性。核心验证点包括：

1.  **因子有效性 (IC Analysis)**：特征是否包含预测未来收益的信息。
2.  **标签分布 (Label Distribution)**：训练目标是否符合统计学假设（如正态性）。
3.  **安全性检查 (Safety Check)**：是否存在未来函数泄露（IC 异常高）或多重共线性。

**✅ 结论速览**：如果 IC 排行榜中存在显著的长条（绝对值 > 0.02），且无异常高的条目（> 0.8），说明特征工程有效且安全。

---

## 2. 因子有效性分析 (Factor Validity)

这是量化模型能否赚钱的核心指标。

### 2.1 IC 排行榜 (Top Features by IC)

* **对应文件**: `feature_ic_top30.png`
* **图表解读**:
    * **X 轴 (IC)**: 信息系数 (Information Coefficient)，即当前特征值与未来收益的相关性。
    * **Y 轴 (Feature)**: 特征名称。
* **✅ 理想形态**:
    * **长度**: 柱子越长，预测力越强。通常 `|IC| > 0.02` 视为有效因子，`|IC| > 0.05` 为强因子。
    * **方向**:
        * **向右 (Positive)**: 正相关（动量类因子常见）。特征越大，未来涨幅越大。
        * **向左 (Negative)**: 负相关（反转类因子常见）。特征越大，未来跌幅越大（A 股常见特征）。
* **⚠️ 警示信号**: 如果某个特征的 `|IC| > 0.8`，极有可能是代码中引入了**未来函数**（Look-ahead Bias），必须立即排查特征计算逻辑。

### 2.2 IC 衰减曲线 (IC Decay Analysis)

* **对应文件**: `ic_decay_curve.png` (由 `check_time_horizon.py` 生成)
* **图表解读**:
    * **X 轴**: 预测周期（持有天数）。
    * **Y 轴**: Rank IC 值。
* **✅ 理想形态**:
    * **发散型**: 随着天数增加，IC 绝对值变大。说明该因子适合做**中长线**（如趋势类因子）。
    * **收敛型**: 随着天数增加，IC 迅速归零。说明该因子适合做**超短线**（如反转类因子）。
* **实战意义**: 用于指导模型训练时的 `horizon` 参数设置。如果主力因子在 20 天时 IC 最强，强行预测 1 天的收益会导致模型效果不佳。

### 2.3 特征相关性热力图 (Feature Correlation Matrix)

* **对应文件**: `feature_correlation.png`
* **图表解读**:
    * 展示特征两两之间的线性相关性。
* **✅ 理想形态**:
    * 颜色应当丰富多样，不应全是大红大蓝。
* **⚠️ 警示信号**:
    * **深红色板块 (Correlation > 0.9)**: 说明出现了**多重共线性**。例如 `MA_5` 和 `MA_10` 可能高度相关。虽然 XGBoost 等树模型对共线性不敏感，但过多的冗余特征会降低训练速度并增加过拟合风险，建议进行特征筛选。

---

## 3. 标签分布分析 (Label Distribution)

评估模型要学习的“目标”是否合理。

### 3.1 标签直方图 (Label Histogram)

* **对应文件**: `dist_label_excess_5d.png` 或 `dist_label.png`
* **图表解读**:
    * 展示了训练目标（如 5日超额收益率）的分布情况。
* **✅ 理想形态**:
    * **正态分布 (Bell Curve)**: 图形应呈现标准的钟形曲线，左右对称，中心在 0 附近。
    * **无双峰**: 不应出现两个波峰，否则说明市场处于极度分裂状态，单模型难以拟合。
* **实战意义**: 如果标签分布极度偏斜（Skewness 很大），建议在训练前对标签进行对数变换或分箱处理。

---

## 4. 数据完整性 (Data Integrity)

* **对应文件**: `missing_ratio.csv` (如有)
* **用途**:
    * 检查特征矩阵中是否存在大量 NaN。
    * **正常情况**: 由于计算 MA60 需要前 60 天数据，因此头部出现少量 NaN 是正常的（< 5%）。
    * **异常情况**: 如果某列缺失率 > 20%，说明该特征计算逻辑有误，或该数据源质量太差，建议剔除该特征。

---

**文档维护者**: Quant_A_Share Team  
**最后更新**: 2025-12-07