# ⏳ 时间窗口敏感性与 IC 衰减分析报告 (Horizon Analysis Report)

**适用范围**：`data/processed` 阶段的数据。  
**生成脚本**：`python scripts/check_time_horizon.py`  
**目标受众**：量化策略师、基金经理。

---

## 1. 概述 (Executive Summary)

本报告旨在回答一个核心问题：“**模型预测几天后的收益最准？**”

不同的因子（特征）具有不同的生效周期（Alpha Decay）。本分析通过计算特征在不同预测周期（1, 2, 3, 5, 10, 20 天）下的 IC 值，描绘出因子的衰减曲线，从而指导我们设置 `config/main.yaml` 中的 `horizon` 参数。

**✅ 核心决策点**：
* 如果主力因子的 IC 峰值出现在 **1-2天** -> 适合做 **超短线 (High Frequency)**。
* 如果主力因子的 IC 峰值出现在 **5-10天** -> 适合做 **短线波段 (Swing Trading)**。
* 如果主力因子的 IC 峰值出现在 **20天+** -> 适合做 **中线趋势 (Trend Following)**。

---

## 2. IC 衰减曲线分析 (IC Decay Curve)

这是全报告最重要的可视化图表。

### 2.1 曲线图解读
* **对应文件**: `ic_decay_curve.png`
* **图表含义**: 展示了 Top 10 特征的预测能力随持有时间的变化趋势。
* **怎么看**:
    * **X 轴 (Horizon)**: 预测跨度（天数）。
    * **Y 轴 (Rank IC)**: 预测能力（绝对值越大越好）。
    * **线条**: 每一条线代表一个特征。

### 2.2 典型形态与含义

在图中，你可能会观察到以下几种典型形态：

#### A. 快速衰减型 (Fast Decay)
* **形态**: IC 绝对值在 **1d 或 2d** 达到最大，随后迅速向 0 收敛。
* **代表因子**: 日内反转 (Reversal)、超买超卖 (RSI)、换手率 (Turnover)。
* **策略建议**: 这类因子只在极短时间内有效。如果你的特征库以这类为主，建议将 `horizon` 设为 **1 或 2**。

#### B. 缓慢爬升/发散型 (Slow Build-up)
* **形态**: IC 在初期（1-3d）很低，甚至接近 0，但随着天数增加，IC 绝对值**越来越大**，在 10d 或 20d 达到峰值。
* **代表因子**: 趋势类 (MACD, MA60_Bias)、基本面因子。
* **策略建议**: 这说明因子的逻辑需要时间发酵（如趋势回归）。如果你的图中出现这种发散线（如 `feat_ma_60_bias`），说明**持有时间越长，胜率越高**，建议将 `horizon` 设为 **10 或 20**。

#### C. 稳定型 (Stable)
* **形态**: IC 曲线近似水平直线，衰减极慢。
* **代表因子**: 优质的低波因子或高胜率逻辑。
* **策略建议**: 这是最理想的因子，对卖出时机不敏感，容错率高。

---

## 3. 数据明细分析 (Data Details)

* **对应文件**: `reports/horizon_analysis/xxxx/ic_decay_data.csv`
* **用途**: 查看具体的 IC 数值，辅助精细化决策。

### 3.1 怎么看数据表
表格的行索引为时间窗口（1d, 2d...），列名为特征。

**示例分析逻辑**：
1.  **找峰值**: 扫描每一列，找到绝对值最大的那个数字。
    * 例如 `feat_rsi_14`: 1d(-0.02) -> 5d(-0.05) -> 20d(-0.01)。峰值在 **5d**。
    * 例如 `feat_macd`: 1d(-0.01) -> 5d(-0.03) -> 20d(-0.08)。峰值在 **20d**。
2.  **定权重**: 如果大部分强特征的峰值都集中在 20d，那么强行做 5d 预测就是在“浪费”这些特征的潜力。

---

## 4. 调优建议 (Optimization Guide)

根据本报告的结果，请检查 `config/main.yaml` 中的配置：

```yaml
preprocessing:
  labels:
    horizon: 5  # <--- 需要根据 IC 峰值调整此处
```

* **保守方案**: 如果不同特征的峰值分散（有的在 1d，有的在 20d），5d 是一个折中的平衡点，兼顾了信号数量和预测质量。

* **激进方案**: 如果你发现 MACD 等趋势因子在 20d 的表现远超 5d（例如 IC 翻倍），可以尝试训练一个 horizon: 20 的中线模型，或者采用双模型策略（一个短线模型吃反转，一个中线模型吃趋势）。

---
**文档维护者**: Quant_A_Share Team  
**最后更新**: 2025-12-07